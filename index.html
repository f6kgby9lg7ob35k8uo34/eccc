<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECC Encryption Example</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/elliptic/6.5.3/elliptic.min.js"></script>
</head>
<body>
    <h1>ECC Encryption Example</h1>
    <textarea id="inputData" rows="4" cols="50" placeholder="Enter data to encrypt..."></textarea><br>
    <button id="encryptButton">Encrypt Data</button>
    <button id="decryptButton" disabled>Decrypt Data</button>
    
    <h2>Results</h2>
    <h3>Encrypted Data:</h3>
    <pre id="encryptedData"></pre>
    <h3>Decrypted Data:</h3>
    <pre id="decryptedData"></pre>

    <script>
        let symmetricKey, iv, encryptedData;

        async function generateKeyPair() {
            const ec = new elliptic.ec('secp256k1');
            const keyPair = ec.genKeyPair();
            return {
                publicKey: keyPair.getPublic('hex'),
                privateKey: keyPair.getPrivate('hex')
            };
        }

        async function encryptData(data) {
            // Generate a random symmetric key
            symmetricKey = window.crypto.getRandomValues(new Uint8Array(32)); // 256-bit key

            // Encrypt the data using AES-GCM
            iv = window.crypto.getRandomValues(new Uint8Array(12)); // Initialization vector
            const encoder = new TextEncoder();
            const encodedData = encoder.encode(data);
            const aesKey = await window.crypto.subtle.importKey('raw', symmetricKey, 'AES-GCM', false, ['encrypt']);
            encryptedData = await window.crypto.subtle.encrypt({ name: 'AES-GCM', iv }, aesKey, encodedData);

            return new Uint8Array(encryptedData);
        }

        async function decryptData(encryptedData) {
            // Decrypt the data using AES-GCM
            const aesKey = await window.crypto.subtle.importKey('raw', symmetricKey, 'AES-GCM', false, ['decrypt']);
            const decryptedData = await window.crypto.subtle.decrypt({ name: 'AES-GCM', iv }, aesKey, encryptedData);
            const decoder = new TextDecoder();
            return decoder.decode(decryptedData);
        }

        document.getElementById('encryptButton').addEventListener('click', async () => {
            const inputData = document.getElementById('inputData').value;
            const encrypted = await encryptData(inputData);
            document.getElementById('encryptedData').textContent = Array.from(encrypted).map(b => b.toString(16).padStart(2, '0')).join('');
            document.getElementById('decryptButton').disabled = false; // Enable decrypt button
        });

        document.getElementById('decryptButton').addEventListener('click', async () => {
            const decrypted = await decryptData(encryptedData);
            document.getElementById('decryptedData').textContent = decrypted;
        });

        // Generate keys on page load
        generateKeyPair().then(keys => {
            console.log('Public Key:', keys.publicKey);
            console.log('Private Key:', keys.privateKey);
        });
    </script>
</body>
</html>
